import{f as e}from"./vendor.519c7c38.js";const t={apiKey:"AIzaSyDxlqgMw0ZX66d5EhDicadqzPGGPi3vZOg",authDomain:"rtcdoconcall.firebaseapp.com",projectId:"rtcdoconcall",storageBucket:"rtcdoconcall.appspot.com",messagingSenderId:"196939761196",appId:"1:196939761196:web:ad6f72c34ed1f701e37389"};e.apps.length||e.initializeApp(t);const a=e.firestore(),n=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});let c=null,o=null;const d=document.getElementById("webcamButton"),i=document.getElementById("webcamVideo"),s=document.getElementById("callButton"),l=document.getElementById("callInput"),r=document.getElementById("answerButton"),p=document.getElementById("remoteVideo"),m=document.getElementById("hangupButton");d.onclick=async()=>{c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),o=new MediaStream,c.getTracks().forEach((e=>{n.addTrack(e,c)})),n.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{o.addTrack(e)}))},i.srcObject=c,p.srcObject=o,s.disabled=!1,r.disabled=!1,d.disabled=!0},s.onclick=async()=>{const e=a.collection("calls").doc(),t=e.collection("offerCandidates"),c=e.collection("answerCandidates");l.value=e.id,n.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const o=await n.createOffer();await n.setLocalDescription(o);const d={sdp:o.sdp,type:o.type};await e.set({offer:d}),e.onSnapshot((e=>{const t=e.data();if(!n.currentRemoteDescription&&(null==t?void 0:t.answer)){const e=new RTCSessionDescription(t.answer);n.setRemoteDescription(e)}})),c.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());n.addIceCandidate(t)}}))})),m.disabled=!1},r.onclick=async()=>{const e=l.value,t=a.collection("calls").doc(e),c=t.collection("answerCandidates"),o=t.collection("offerCandidates");n.onicecandidate=e=>{e.candidate&&c.add(e.candidate.toJSON())};const d=(await t.get()).data().offer;await n.setRemoteDescription(new RTCSessionDescription(d));const i=await n.createAnswer();await n.setLocalDescription(i);const s={type:i.type,sdp:i.sdp};await t.update({answer:s}),o.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(e),"added"===e.type){let t=e.doc.data();n.addIceCandidate(new RTCIceCandidate(t))}}))}))};
